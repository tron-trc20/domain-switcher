<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>跳转中...</title>
    <script src="config.js"></script>
    <script>
        // 从localStorage获取域名状态
        function getDomainStatus() {
            return JSON.parse(localStorage.getItem('domainStatus') || '{}');
        }

        // 从localStorage获取当前使用的域名索引
        let currentIndex = parseInt(localStorage.getItem('currentDomainIndex') || '0');

        // 获取下一个可用域名
        function getNextDomain() {
            const domains = CONFIG.activeDomains;
            const status = getDomainStatus();
            let attempts = 0;
            
            while (attempts < domains.length) {
                // 如果当前索引超出范围，重置为0
                if (currentIndex >= domains.length) {
                    currentIndex = 0;
                }
                
                const domain = domains[currentIndex];
                
                // 检查域名是否可用
                if (status[domain] !== 'blocked') {
                    // 更新索引并保存
                    currentIndex = (currentIndex + 1) % domains.length;
                    localStorage.setItem('currentDomainIndex', currentIndex.toString());
                    return domain;
                }
                
                currentIndex++;
                attempts++;
            }
            
            // 如果所有域名都被禁用，使用第一个域名
            return domains[0];
        }

        // 主要逻辑
        window.onload = function() {
            // 检查是否在微信中
            const isWeChat = /MicroMessenger/i.test(navigator.userAgent);
            
            if (isWeChat) {
                const currentDomain = window.location.hostname;
                const status = getDomainStatus();
                
                // 如果当前是github.io域名或者是被禁用的域名，跳转到下一个可用域名
                if (currentDomain.includes('github.io') || status[currentDomain] === 'blocked') {
                    const nextDomain = getNextDomain();
                    window.location.href = `https://${nextDomain}`;
                }
            } else {
                // 如果不是在微信中访问，显示提示信息
                document.body.innerHTML = `
                    <div style="text-align: center; margin-top: 50px;">
                        <h2>请在微信中打开此页面</h2>
                        <p>本服务仅支持微信访问</p>
                    </div>
                `;
            }
        };
    </script>
</head>
<body>
    <div style="text-align: center; margin-top: 50px;">
        <h2>正在加载...</h2>
        <p>请稍候，正在切换到可用域名</p>
    </div>
</body>
</html> 